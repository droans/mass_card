script:
  get_player_queues:
    alias: Music Assistant-Get Player Queues
    mode: parallel
    fields:
      limit_before:
        name: Limit Before
        selector:
          number:
            max: 1000
            min: 0
      limit_after:
        name: Limit After
        selector:
          number:
            max: 1000
            min: 0
      target:
        name: Target
        selector:
          target:
            entity:
              - domain: media_player
                integration: music_assistant
    variables:
      defaults:
        before: 5
        after: 40
      targets: >-
        {% if target is defined %}
          {% set targets = target.get('entity_id', []) %}
        {% else %}
          {% set targets = [] %}
        {% endif %}
        {% if targets is string %}
          {% set targets = [targets] %}
        {% endif %}
        {% set ns = namespace(result = []) %}
        {% for item in targets %}
          {% if item is string and item.startswith('media_player') %}
            {% set ns.result = ns.result + [item] %}
          {% endif %}
        {% endfor %}
        {% set result = ns.result %}
        {{ result }}
      entity_ids: >-
        {% if entity_id is defined %}
          {% set ids = entity_id %}
        {% endif %}
        {% if ids is not list %}
          {% set ids = [ids] %}
        {% endif %}
        {% set ns = namespace(result = []) %}
        {% for item in ids %}
          {% if item is string and item.startswith('media_player') %}
            {% set ns.result = ns.result + [item] %}
          {% endif %}
        {% endfor %}
        {% set result = ns.result %}
        {{ result }}
      entities: >-
        {% set result = targets + entity_ids %}
        {{ result }}
      before: >-
        {% if limit_before is defined %}
          {% set result = limit_before %}
        {% else %}
          {% set result = defaults.before %}
        {% endif %}
        {{ result }}
      after: >-
        {% if limit_after is defined %}
          {% set result = limit_after %}
        {% else %}
          {% set result = defaults.after %}
        {% endif %}
        {{ result }}
    sequence:
      - action: pyscript.get_player_queue
        data:
          player_entity: >-
            {% set result = entities %}
            {{ result }}
          limit_before: >
            {% set result = before %}
            {{ result }}
          limit_after: >-
            {% set result = after %}
            {{ result }}
        response_variable: queues
      - stop:
        response_variable: queues

  mass_play_queue_item:
    alias: Music Assistant - Play Queue Item
    trace: *default-trace
    mode: single
    fields:
      player: 
        name: Player
        selector:
          entity:
            filter:
              - domain: media_player
                integration: music_assistant
      queue_item_id:
        name: Queue Item ID
        selector:
          text:
    sequence:
      - action: pyscript.play_queue_item
        data:
          player_entity: >-
            {% set result = player %}
            {{ result }}
          queue_item_id: >-
            {% set result = queue_item_id %}
            {{ result }}
  mass_remove_queue_item:
    alias: Music Assistant - Remove Queue Item
    trace: *default-trace
    mode: single
    fields:
      player: 
        name: Player
        selector:
          entity:
            filter:
              - domain: media_player
                integration: music_assistant
      queue_item_id:
        name: Queue Item ID
        selector:
          text:
    sequence:
      - action: pyscript.remove_queue_item
        data:
          player_entity: >-
            {% set result = player %}
            {{ result }}
          queue_item_id: >-
            {% set result = queue_item_id %}
            {{ result }}